# Постановка задачи
Алгоритм решает задачу маршрутизации бензовозов с несколькими отсеками на одну рабочую смену (Multi-Compartment Vehicle Routing Problem).

Бензовозы имеют отсеки различной вместимости и могут использовать несколько шлангов для разгрузки топлива. 
Задано множество АЗС, а также время движения между станциями. 
Для подземных резервуаров станций известны виды топлива, а также верхняя и нижняя границы доставляемого топлива. 

Требуется построить маршруты бензовозов для доставки топлива на АЗС, используя минимальное число бензовозов. 
Бензовоз может выполнять несколько рейсов суммарной длительностью меньше длины смены. 
Бензовоз выезжает из депо с полностью загруженными отсеками, каждый отсек бензовоза выгружается целиком в один из резервуаров АЗС, а каждый резервуар заполняется только одним бензовозом.
Разработан алгоритм, позволяющий эффективно получить качественное допустимое решение задачи.

В ходе решения создаётся изначальный набор маршрутов, посещающих не более R1 станций, при этом каждая следующая станция выбирается среди R2 станций, ближайших к предыдущей. 
С помощью алгоритма динамического программирования для каждого маршрута находятся резервуары, которые можно заполнить при выполнении этого маршрута. 
Затем вычисляются длительности маршрутов с учётом возможности ускоренной разгрузки несколькими шлангами. 
Полученные маршруты используются для переформулировки исходной модели в виде задачи о разбиении, которая решается солвером.

## Этапы решения задачи

1. **Генерация допустимых маршрутов**

2. **Поиск всех вариантов заполнения резервуаров для станций в маршруте**

3. **Расчёт времени маршрутов**

4. **Решение задачи о разбиении солвером**


# Математическая постановка

<img width="620.25" height="894.75" alt="image" src="https://github.com/user-attachments/assets/95b6fdb9-6b47-4149-8b8d-8556adf690b8" />

  **Целевая функция (1)**  
Минимизирует число используемых бензовозов.

**Ограничение (2)**  
Отвечает за доступность заправок в соответствии со входными параметрами $a_{ik}$.

**Ограничение (3)**  
Запрещает использовать бензовоз дольше, чем длина рабочей смены.

**Ограничение (4)**  
Отвечает за корректное заполнение резервуаров отсеками: итоговый объем привезённого топлива должен быть больше минимального требуемого объема, но меньше максимальной вместимости резервуара.

**Ограничение (5)**  
Заставляет целиком выливать отсек бензовоза.

**Ограничение (6)**  
Устанавливает связь между числом смен и использованием бензовоза: бензовоз используется, если выходит хоть на одну смену.

**Ограничение (7)**  
Заставляет заполнять все отсеки бензовоза при выходе на смену и не заполнять их в противном случае, а также связывает эту переменную с $y$.

**Ограничение (8)**  
Отвечает за связь $z$ и $y$: привозить груз можно только при посещении этой станции (из некоторой другой станции $j$).

**Ограничение (9)**  
Устанавливает число смен равным числу выездов из депо.

**Ограничение (10)**  
Запрещает останавливаться в промежуточных станциях: если бензовоз приехал в какую-то станцию, он обязан из неё выехать.

**Ограничение (11)**  
Запрещает подциклы: среди $|S|$ станций должно быть не более $|S-1|$ рёбер, чтобы граф был ациклическим. При этом депо не участвует в рассмотрении, так как циклы через депо считаются различными рейсами и допустимы.

**Ограничение (12)**  
Заставляет выгружать первый отсек бензовоза на последней станции рейса.

**Ограничение (13)**  
Позволяет использовать различные шланги только при действительной выгрузке топлива на станции, связывая $t$ и $y$.

**Ограничение (14)**  
Определяет, что каждый отсек выгружается только одним шлангом.

**Ограничение (15)**  
Позволяет выгружать топливо только при посещении станции.

**Ограничение (16)**  
Связывает $h$ и $g$, запрещая посещать станцию бензовозом, не совершающим рейсов.

**Ограничение (17)**  
Отмечает, что первый шланг освобождается не раньше других, гарантируя, что время его работы максимально.

### С увеличением числа станций размер задачи и число ограничений растёт очень быстро, и решить её в исходной формулировке не удаётся. 


# Модель задачи о разбиении множества

<img width="622" height="333" alt="image" src="https://github.com/user-attachments/assets/7547e77d-5931-45d5-8eec-b4cf7ccb7d32" />




